---
const GA_ID = import.meta.env.PUBLIC_GA_ID; // Make sure to add this to your .env file
---

{GA_ID && (
  <Fragment>
    <script type="module" define:vars={{ GA_ID }}>
      // Create script element with modern analytics
      const script = document.createElement('script');
      script.src = `https://www.googletagmanager.com/gtag/js?id=${GA_ID}`;
      script.async = true;
      document.head.appendChild(script);

      // Initialize dataLayer and gtag function
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag('js', new Date());
      gtag('config', GA_ID, {
        send_page_view: false, // We'll handle this manually
        anonymize_ip: true,
        cookie_flags: 'SameSite=None;Secure'
      });

      // Handle page views with performance tracking
      document.addEventListener('astro:page-load', () => {
        gtag('event', 'page_view', {
          page_title: document.title,
          page_location: window.location.href,
          page_path: window.location.pathname
        });
      });
    </script>
  </Fragment>
)} 